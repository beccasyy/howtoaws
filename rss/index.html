<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[The Guiding Cloud]]></title><description><![CDATA[A guide to all things cloud]]></description><link>http://localhost:2368/</link><image><url>http://localhost:2368/favicon.png</url><title>The Guiding Cloud</title><link>http://localhost:2368/</link></image><generator>Ghost 4.11</generator><lastBuildDate>Sat, 28 Aug 2021 15:13:00 GMT</lastBuildDate><atom:link href="http://localhost:2368/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[AWS Lambda Python Hash Producing Different Results]]></title><description><![CDATA[Here is a short and sweet guide on what to do if your Python Hash is producing different results!]]></description><link>http://localhost:2368/aws-lambda-python-hash-produce-different-results/</link><guid isPermaLink="false">6110eb64f170170ab7c05419</guid><category><![CDATA[Articles]]></category><dc:creator><![CDATA[Rebecca]]></dc:creator><pubDate>Mon, 09 Aug 2021 08:46:34 GMT</pubDate><media:content url="http://localhost:2368/content/images/2021/08/Hash-Zappa-Article.jpeg" medium="image"/><content:encoded><![CDATA[<img src="http://localhost:2368/content/images/2021/08/Hash-Zappa-Article.jpeg" alt="AWS Lambda Python Hash Producing Different Results"><p></p><p>When I deployed my <a href="https://flask.palletsprojects.com/en/2.0.x/">Flask</a> web application to AWS using <a href="https://github.com/Miserlou/flask-zappa">Zappa</a>, I discovered that users could not log in.</p><p>After reading the logs, I realised that the checksums generated whenever a user logs in, were different despite the constant variables (username and user ID).</p><figure class="kg-card kg-code-card"><pre><code class="language-python">user_name = &apos;jake&apos;
user_id = &apos;1001&apos;
checksum = hash(user_name + user_id)

print(checksum)
# 3631206479466447074
# Your result will differ, read more to understand!</code></pre><figcaption>Snippet of the code to generate the checksum</figcaption></figure><p>I wondered why.</p><p>Following a consultation with Google, I came across this <a href="https://stackoverflow.com/questions/27522626/hash-function-in-python-3-3-returns-different-results-between-sessions">Stack Overflow</a> article.</p><blockquote>&quot;Python uses a random hash seed to prevent attackers from tar-pitting your application by sending you keys designed to collide...By offsetting the hash with a random seed (set once at startup) attackers can no longer predict what keys will collide.&quot;</blockquote><p>Here is a further explanation of the above paragraph!</p><p>Zappa works in tandem with AWS API Gateway and AWS Lambda. For each request to the site, API Gateway sends the request to a Lambda worker. The worker could be a different worker that handled the previous request and, as such, has a different random seed generated at startup.</p><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2021/08/api-gateway-lambda.png" class="kg-image" alt="AWS Lambda Python Hash Producing Different Results" loading="lazy" width="1282" height="562" srcset="http://localhost:2368/content/images/size/w600/2021/08/api-gateway-lambda.png 600w, http://localhost:2368/content/images/size/w1000/2021/08/api-gateway-lambda.png 1000w, http://localhost:2368/content/images/2021/08/api-gateway-lambda.png 1282w" sizes="(min-width: 720px) 720px"></figure><p>How did I overcome this?</p><p>I cannot force all requests to be routed to a single Lambda worker (this will result in a bottleneck and affect the scalability). Moreover, all Lambda workers are ephemeral, meaning that they last for a short period of time and dies when they are no more requests.</p><p>A quick and easy way is to change the hash function. Instead of using the native hash function, you can utilise the <em>hashlib</em> library to generate a md5 hash. Regardless of where you run this code, you will always generate the same hashed results.</p><figure class="kg-card kg-code-card"><pre><code class="language-Python">import hashlib

user_name = &apos;jake&apos;
user_id = &apos;1001&apos;

checksum = hashlib.md5((user_name + user_id).encode(&apos;utf-8&apos;)).hexdigest()

print(checksum)
# cff72a0287fe0d6e40a60fd71c71d116</code></pre><figcaption>Snippet of code to generate checksum with md5</figcaption></figure><hr><p>Thats all! Let me know if the solution works for you. </p><p><em>Photo used: &#xA0;<a href="https://unsplash.com/@hedgehog90">Liudmyla Denysiuk</a> on <a href="https://unsplash.com/">Unsplash</a></em></p>]]></content:encoded></item></channel></rss>